// --- TRANSLATION DATA ---
const translations = {
    en: {
        nav_features: "Features",
        nav_how: "How it Works",
        nav_sponsor: "Sponsor a Student",
        nav_start: "Get Started Free",
        hero_badge: "Now Live in Nepal",
        hero_title_1: "Crack the Iron Gate.",
        hero_title_2: "No Data? No Problem.",
        hero_desc: "<strong>पढAI</strong> (PadhAI) is the first offline-ready private tutor that speaks colloquial Nepali. Switch to 'Radio Mode' to save 95% of your data and study anywhere.",
        hero_cta_primary: "Start Learning Now",
        hero_cta_secondary: "Try the Demo Below ↓",
        benefit_offline: "Offline Mode",
        benefit_audio: "Nepali Audio",
        benefit_data: "Low Bandwidth",
        feat_header: "Why पढAI works where others fail",
        feat_sub: "Built for the reality of rural Nepal, not Silicon Valley.",
        feat_1_title: "Radio Mode™",
        feat_1_desc: "We separate audio from video visuals. This reduces lesson size from 300MB to just 15MB. Study all month on a basic data pack.",
        feat_2_title: "Language Bridge",
        feat_2_desc: "English textbooks are hard. Our AI explains complex Science concepts using simple, colloquial Nepali analogies.",
        feat_3_title: "Power-Cut Proof",
        feat_3_desc: "One click saves the lesson to your browser. When the electricity goes out ('Line Gayo'), your education doesn't stop.",
        sponsor_title: "For Parents Abroad",
        sponsor_desc: "Don't just send money for daily expenses. Send money for their future. Use the <strong>Remittance Sponsor</strong> model to pay for your child's subscription directly from Malaysia, Qatar, or Korea.",
        sponsor_check_1: "Secure International Payment",
        sponsor_check_2: "Weekly Progress Reports (SMS/App)",
        sponsor_check_3: "Only NPR 400 / Month",
        sponsor_cta: "Sponsor a Student Now",
        dash_title: "Sponsor Dashboard Preview",
        modal_title: "Unlock Premium",
        modal_sub: "Ask a family member to sponsor.",
        modal_code_label: "Student Code:",
        modal_whatsapp: "Send via WhatsApp",
        modal_simulate: "Simulate Payment"
    },
    np: {
        nav_features: "विशेषताहरू",
        nav_how: "यो कसरी काम गर्छ",
        nav_sponsor: "विद्यार्थी प्रायोजन गर्नुहोस्",
        nav_start: "नि:शुल्क सुरु गर्नुहोस्",
        hero_badge: "अब नेपालमा उपलब्ध",
        hero_title_1: "SEE (फलामे ढोका) फोड्नुहोस्।",
        hero_title_2: "डाटा छैन? चिन्ता छैन।",
        hero_desc: "<strong>पढAI</strong> (PadhAI) पहिलो अफलाइन-रेडी निजी शिक्षक हो जुन नेपाली भाषामा बोल्छ। ९५% डाटा बचाउन 'रेडियो मोड' मा स्विच गर्नुहोस् र जहाँसुकै पढ्नुहोस्।",
        hero_cta_primary: "अहिले पढ्न सुरु गर्नुहोस्",
        hero_cta_secondary: "तल डेमो प्रयास गर्नुहोस् ↓",
        benefit_offline: "अफलाइन मोड",
        benefit_audio: "नेपाली अडियो",
        benefit_data: "कम ब्यान्डविथ",
        feat_header: "पढAI किन सफल छ जहाँ अरू असफल हुन्छन्",
        feat_sub: "सिलिकन भ्यालीको लागि होइन, ग्रामीण नेपालको वास्तविकताको लागि बनाइएको।",
        feat_1_title: "रेडियो मोड™",
        feat_1_desc: "हामी अडियोलाई भिडियो दृश्यबाट अलग गर्छौं। यसले पाठको आकार ३००MB बाट मात्र १५MB मा घटाउँछ। आधारभूत डाटा प्याकमा महिनाभरि अध्ययन गर्नुहोस्।",
        feat_2_title: "भाषा पुल",
        feat_2_desc: "अङ्ग्रेजी पाठ्यपुस्तकहरू गाह्रो हुन्छन्। हाम्रो AI ले जटिल विज्ञान अवधारणाहरू सरल, बोलचालको नेपाली उदाहरणहरू प्रयोग गरेर व्याख्या गर्दछ।",
        feat_3_title: "पावर-कट प्रुफ",
        feat_3_desc: "एक क्लिकले पाठलाई तपाईंको ब्राउजरमा बचत गर्छ। जब बिजुली जान्छ ('लाइन गयो'), तपाईंको शिक्षा रोकिँदैन।",
        sponsor_title: "विदेशका अभिभावकहरूका लागि",
        sponsor_desc: "दैनिक खर्चको लागि मात्र पैसा नपठाउनुहोस्। उनीहरूको भविष्यको लागि पैसा पठाउनुहोस्। मलेसिया, कतार वा कोरियाबाट सिधै आफ्नो बच्चाको सदस्यताको लागि भुक्तानी गर्न <strong>रेमिटेन्स प्रायोजन</strong> मोडेल प्रयोग गर्नुहोस्।",
        sponsor_check_1: "सुरक्षित अन्तर्राष्ट्रिय भुक्तानी",
        sponsor_check_2: "साप्ताहिक प्रगति रिपोर्टहरू (SMS/App)",
        sponsor_check_3: "केवल NPR ४०० / महिना",
        sponsor_cta: "अहिले विद्यार्थी प्रायोजन गर्नुहोस्",
        dash_title: "प्रायोजक ड्यासबोर्ड पूर्वावलोकन",
        modal_title: "प्रिमियम अनलक गर्नुहोस्",
        modal_sub: "परिवारको सदस्यलाई प्रायोजन गर्न सोध्नुहोस्।",
        modal_code_label: "विद्यार्थी कोड:",
        modal_whatsapp: "व्हाट्सएप मार्फत पठाउनुहोस्",
        modal_simulate: "भुक्तानी सिमुलेट गर्नुहोस्"
    }
};

function switchLang(lang) {
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
            el.innerHTML = translations[lang][key];
        }
    });

    // Toggle UI styles
    const btnEn = document.getElementById('btn-en');
    const btnNp = document.getElementById('btn-np');
    
    if (lang === 'en') {
        document.body.classList.remove('nepali-font');
        btnEn.className = "px-3 py-1 text-xs font-bold rounded-md bg-white shadow-sm text-slate-800 transition-all";
        btnNp.className = "px-3 py-1 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 transition-all";
    } else {
        document.body.classList.add('nepali-font');
        btnNp.className = "px-3 py-1 text-xs font-bold rounded-md bg-white shadow-sm text-slate-800 transition-all";
        btnEn.className = "px-3 py-1 text-xs font-bold rounded-md text-slate-500 hover:text-slate-800 transition-all";
    }
}

// --- APP LOGIC ---
let isPlaying = false;
let isRadioMode = true; 
let currentSlide = 0;
let playInterval;
let progress = 0;

const slides = [
    { title: "Newton's Second Law", icon: "fa-rocket", sub: "F = m × a" },
    { title: "Force (F)", icon: "fa-hand-rock", sub: "Push or Pull" },
    { title: "Mass (m)", icon: "fa-weight-hanging", sub: "Matter Amount" },
    { title: "Acceleration (a)", icon: "fa-tachometer-alt", sub: "Speed Change" }
];

document.addEventListener('DOMContentLoaded', function() {
    // Radio Mode Toggle for Video Player
    const radioModeToggle = document.getElementById('radio-mode-toggle');
    const videoPlayer = document.getElementById('video-player');
    const radioModeUI = document.getElementById('radio-mode-ui');
    const audioProgress = document.getElementById('audio-progress');
    const radioPlayPause = document.getElementById('radio-play-pause');
    const radioStatus = document.getElementById('radio-status');
    
    if (radioModeToggle && videoPlayer && radioModeUI) {
        radioModeToggle.addEventListener('change', (e) => {
            const isRadio = e.target.checked;
            
            if (isRadio) {
                // Switch to Radio Mode
                videoPlayer.classList.add('hidden');
                radioModeUI.classList.remove('hidden');
                showToast("Radio Mode: Saving 95% Data");
                
                // Update play/pause button state
                updateRadioPlayPauseButton();
                
                // Sync audio progress with video
                const updateProgress = () => {
                    if (videoPlayer.duration > 0) {
                        const percent = (videoPlayer.currentTime / videoPlayer.duration) * 100;
                        audioProgress.style.width = percent + '%';
                    }
                };
                videoPlayer.addEventListener('timeupdate', updateProgress);
            } else {
                // Switch to Video Mode
                videoPlayer.classList.remove('hidden');
                radioModeUI.classList.add('hidden');
                showToast("Video Mode: High Data");
            }
        });
        
        // Radio Mode Play/Pause Button
        if (radioPlayPause) {
            radioPlayPause.addEventListener('click', () => {
                if (videoPlayer.paused) {
                    videoPlayer.play();
                    radioStatus.textContent = "Audio playing • Saving 95% data";
                } else {
                    videoPlayer.pause();
                    radioStatus.textContent = "Audio paused • Saving 95% data";
                }
                updateRadioPlayPauseButton();
            });
        }
        
        // Update button icon based on video state
        function updateRadioPlayPauseButton() {
            if (radioPlayPause) {
                const icon = radioPlayPause.querySelector('i');
                if (videoPlayer.paused) {
                    icon.classList.remove('fa-pause');
                    icon.classList.add('fa-play');
                } else {
                    icon.classList.remove('fa-play');
                    icon.classList.add('fa-pause');
                }
            }
        }
        
        // Listen for video play/pause events to sync button
        videoPlayer.addEventListener('play', updateRadioPlayPauseButton);
        videoPlayer.addEventListener('pause', updateRadioPlayPauseButton);
    }
    
    // Legacy toggle switch (if exists)
    const toggleSwitch = document.getElementById('data-saver-toggle');
    if (toggleSwitch) {
        toggleSwitch.checked = true; 

        toggleSwitch.addEventListener('change', (e) => {
            isRadioMode = e.target.checked;
            const videoUI = document.getElementById('video-ui');
            const radioUI = document.getElementById('radio-ui');
            if (videoUI && radioUI) {
                videoUI.classList.toggle('hidden', isRadioMode);
                radioUI.classList.toggle('hidden', !isRadioMode);
                if (!isRadioMode) togglePlay(false);
                showToast(isRadioMode ? "Radio Mode: Saving Data" : "Video Mode: High Data");
            }
        });
    }
});

function togglePlay(forceState = null) {
    const overlay = document.getElementById('play-overlay');
    const icon = overlay.querySelector('i');
    if (forceState !== null) isPlaying = !forceState;
    
    if (isPlaying) {
        isPlaying = false;
        overlay.style.opacity = "1";
        icon.classList.remove('fa-pause');
        icon.classList.add('fa-play');
        clearInterval(playInterval);
    } else {
        isPlaying = true;
        overlay.style.opacity = "0"; 
        icon.classList.remove('fa-play');
        icon.classList.add('fa-pause');
        playInterval = setInterval(() => {
            progress += 1;
            if(progress > 100) progress = 0;
            document.getElementById('progress-bar').style.width = progress + "%";
            if (progress % 25 === 0) changeSlide();
        }, 100);
    }
}

function changeSlide() {
    currentSlide = (currentSlide + 1) % slides.length;
    const data = slides[currentSlide];
    const content = document.getElementById('slide-content');
    content.style.opacity = 0;
    setTimeout(() => {
        content.innerHTML = `<i class="fas ${data.icon} text-4xl text-blue-600 mb-2"></i><h2 class="text-lg font-bold">${data.title}</h2><p class="text-xs text-slate-600">${data.sub}</p>`;
        content.style.opacity = 1;
    }, 300);
}

function toggleOffline(btn) {
    const icon = btn.querySelector('i');
    const text = btn.querySelector('.btn-text');
    icon.classList.remove('fa-download');
    icon.classList.add('fa-spinner', 'fa-spin');
    setTimeout(() => {
        icon.classList.remove('fa-spinner', 'fa-spin');
        if (btn.classList.contains('bg-green-50')) {
            // Remove
            btn.classList.remove('bg-green-50', 'text-green-700', 'border-green-200');
            btn.classList.add('bg-slate-700', 'text-white');
            icon.classList.add('fa-download');
            if(text) text.innerText = "Save Offline (15MB)";
            showToast("Lesson removed");
        } else {
            // Add
            btn.classList.remove('bg-slate-700', 'text-white');
            btn.classList.add('bg-green-50', 'text-green-700', 'border-green-200');
            icon.classList.add('fa-check');
            if(text) text.innerText = "Saved";
            showToast("Lesson Saved Offline");
        }
    }, 800);
}

const modal = document.getElementById('sponsor-modal');
function openSponsorModal() { modal.classList.remove('hidden'); }
function closeSponsorModal() { modal.classList.add('hidden'); }

function shareCode() {
    showToast("Opening WhatsApp...");
    setTimeout(() => window.open("https://wa.me/?text=Baba,%20I%20need%20this%20app%20to%20pass%20my%20SEE%20Exams.%20My%20code%20is%20884-291.%20It%20costs%20NPR%20400.", "_blank"), 500);
}

function simulatePayment() {
    closeSponsorModal();
    showToast("Payment Simulated!");
    document.querySelectorAll('.opacity-75').forEach(card => {
        card.classList.remove('opacity-75');
        const btn = card.querySelector('button');
        btn.className = "w-7 h-7 rounded-full border border-slate-300 flex items-center justify-center text-slate-400";
        btn.innerHTML = '<i class="fas fa-download text-[10px]"></i>';
        btn.setAttribute('onclick', 'toggleOffline(this)');
    });
}

function showToast(msg) {
    const toast = document.getElementById('toast');
    document.getElementById('toast-msg').innerText = msg;
    toast.style.opacity = "1";
    setTimeout(() => toast.style.opacity = "0", 3000);
}
